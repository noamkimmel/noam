<!DOCTYPE html>
<html lang="he">
  <head>
    <meta charset="UTF-8" />
    <title>📦 סורק ברקודים</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #121212;
        color: #ffffff;
        font-family: "Segoe UI", sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }
      h1 {
        margin-bottom: 1rem;
      }
      video {
        width: 90vw;
        max-width: 600px;
        border: 4px solid #00ff99;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0, 255, 153, 0.6);
      }
      #output {
        margin-top: 1.5rem;
        padding: 1rem;
        background-color: #1e1e1e;
        border: 2px dashed #00ff99;
        border-radius: 8px;
        font-size: 1.5rem;
        min-width: 300px;
        text-align: center;
        direction: ltr;
      }
    </style>
  </head>
  <body>
    <h1>📷 סורק ברקודים</h1>
    <video id="preview" autoplay muted playsinline></video>
    <div id="output">🔍 מחפש קוד...</div>

    <script type="module">
      import {
        BrowserMultiFormatReader,
        NotFoundException
      } from 'https://cdn.jsdelivr.net/npm/@zxing/browser@0.0.11/esm/index.js';

      const video = document.getElementById('preview');
      const output = document.getElementById('output');

      async function startCamera() {
        try {
          const devices = await navigator.mediaDevices.enumerateDevices();
          const videoInputDevices = devices.filter(d => d.kind === 'videoinput');
          const deviceId = videoInputDevices.length ? videoInputDevices[0].deviceId : null;

          const codeReader = new BrowserMultiFormatReader();
          codeReader.decodeFromVideoDevice(deviceId, video, (result, err) => {
            if (result) {
              output.textContent = `✅ נמצא קוד: ${result.getText()}`;
            } else if (err && !(err instanceof NotFoundException)) {
              console.error('שגיאה:', err);
              output.textContent = '❌ שגיאה בזיהוי';
            }
          });
        } catch (err) {
          console.error('גישה למצלמה נדחתה או נכשלה:', err);
          output.textContent = '⚠️ לא ניתן להפעיל מצלמה';
        }
      }

      startCamera();
    </script>
  </body>
</html>
